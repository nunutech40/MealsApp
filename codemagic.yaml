workflows:
  ios_ci:
    name: iOS CI (tanpa CocoaPods)
    max_build_duration: 60
    environment:
      xcode: latest

    triggering:
      events:
        - push
      branch_patterns:
        - pattern: main
          include: true
          source: true

    scripts:
      - name: Debug layout
        script: |
          echo "PWD=$(pwd)"
          ls -la
          echo "=== Cari workspace/project ==="
          git ls-files | grep -E '\.xcworkspace$|\.xcodeproj$' || true

      - name: Build for iOS Simulator (xcodebuild)
        script: |
          set -euo pipefail
          # Jika kamu punya .xcworkspace (karena pernah pakai pods), gunakan itu.
          # Kalau tidak, langsung gunakan .xcodeproj seperti di screenshotmu.
          xcodebuild \
            -project MealsApp/MealsApp.xcodeproj \
            -scheme MealsApp \
            -sdk iphonesimulator \
            -destination 'platform=iOS Simulator,OS=latest,name=iPhone 16' \
            clean build | xcpretty

    artifacts:
      - $HOME/Library/Developer/Xcode/DerivedData/**/Build/**/*.app
      - $HOME/Library/Logs/**/*
    publishing:
      email:
        recipients:
          - nunutech4.0@gmail.com
        notify:
          success: false
          failure: true
